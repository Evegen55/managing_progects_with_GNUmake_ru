%%%------------------------------------------------------------------
%%% Portable makefiles
%%%------------------------------------------------------------------
\chapter{Переносимые \Makefile{}'ы}
\label{chap:portable_makefiles}

Какой же \Makefile{} мы будем считать переносимым? В качестве
экстремального примера мы хотим иметь \Makefile{}, запускающийся без
изменений на любой платформе, позволяющей запустить GNU \GNUmake{}.
Однако это практически невозможно по причине огромного количества
различных операционных систем. Более разумным будет назвать
переносимым \Makefile{}, который легко изменить для запуска на другой
платформе. Однако перенос на другую платформу не должен препятствовать
поддержке всех предыдущих платформ, это будет дополнительным важным
ограничением.

Мы можем достичь этого уровня переносимости \Makefile{}'ов, используя
те же техники, что и в традиционном программировании: инкапсуляция и
абстракция. Используя переменные и функции, определяемые
пользователем, мы можем инкапсулировать приложения и алгоритмы.
Определяя переменные для аргументов командной строки и параметров, мы
можем абстрагироваться от элементов, варьирующихся от платформы к
платформе.

Затем вам потребуется определить, какие инструменты может предложить
каждая платформа для выполнения вашей работы, и какие из них нужно
использовать в случае каждой конкретной платформы. Наибольшую
переносимость приносит использование только тех инструментов, которые
присутствуют на всех интересующих платформах. Обычно это называют
подходом <<наименьшего общего знаменателя>>, который, очевидно, может
сделать базовый набор инструментов довольно скудным.

Другой версией подхода наименьшего общего знаменателя является
следующая парадигма: используйте мощный набор инструментов и
убедитесь, что можете взять его с собой на любую платформу. Это
гарантирует, что команды, которые вы вызываете в \Makefile{}'е,
работают совершенно одинаково в любой системе. Осуществить это, как
правило, нелегко, и с административной точки зрения, и в плане
убеждения вашей организации в необходимости кооперации её систем с
вашими  наработками. Однако такой подход может приносить результаты, и
позже я приведу приведу пример с пакетом Cygwin для Windows. Как вы
увидите, стандартизация инструментов не решает всех проблем, всегда
найдутся отличия операционных систем, которые нужно будет обрабатывать
особым образом.

Наконец, вы можете принять различия между системами как данность и
обходить их с помощью аккуратного выбора функций и макросов. Я приведу
пример такого подхода в этой главе.

Таким образом, рассудительно используя переменные и функции,
определяемые пользователем, минимизируя использование экзотических
возможностей и полагаясь на стандартные инструменты, мы можем
увеличить переносимость наших \Makefile{}'ов. Как уже было замечено,
идеальная переносимость недостижима, поэтому нашей задачей является
нахождение баланса между затратами и переносимостью. Однако прежде,
чем мы исследуем специфические техники, давайте произведём обзор
основных проблем переносимости \Makefile{}'ов.

\input{./src/latex/part2/portable-makefiles/portability-issues.tex}
\input{./src/latex/part2/portable-makefiles/cygwin.tex}
\input{./src/latex/part2/portable-makefiles/managing-programs-and-files.tex}
\input{./src/latex/part2/portable-makefiles/working-with-nonportable-tools.tex}
\input{./src/latex/part2/portable-makefiles/automake.tex}
